services:
  wanda:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: picoclaw-wanda
    restart: unless-stopped

    # Bridge network with host-gateway so host.docker.internal resolves to the host.
    # Wanda's config already uses host.docker.internal for Whisper STT.
    extra_hosts:
      - "host.docker.internal:host-gateway"

    volumes:
      # Mount existing Wanda config and workspace directly
      - ~/.picoclaw/config.json:/root/.picoclaw/config.json:ro
      - ~/.picoclaw/workspace:/root/.picoclaw/workspace
      # Codex CLI auth â€” mounted at both paths because the state DB has
      # absolute host paths (/home/emad/.codex/...) baked into it
      - ~/.codex:/root/.codex:ro
      - ~/.codex:/home/emad/.codex:ro

    command: ["gateway"]

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
